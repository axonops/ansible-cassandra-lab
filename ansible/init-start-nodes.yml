- name: Start or restart Cassandra and AxonOps Agent (SEEDS Only)
  hosts: "seeds"
  become: true
  serial: 1
  vars:
    state: started
    wipe: false
  tasks:
    - name: Starting seeds
      block:
        - name: Start Cassandra service
          ansible.builtin.service:
            name: cassandra
            state: "{{ state }}"

        - name: Start AxonOps Agent
          ansible.builtin.service:
            name: axon-agent
            state: "{{ state }}"

        - name: Wait for Cassandra to be up and running
          ansible.builtin.wait_for:
            port: 9042
            host: "{{ cassandra_listen_address | default(ansible_default_ipv4.address) | default('localhost') }}"
            timeout: 300
            state: started

- name: Start or restart Cassandra and AxonOps Agent (Non Seeds)
  hosts: "cassandra:!seeds"
  become: true
  serial: 1
  vars:
    state: started
  tasks:
    - name: Starting non-seeds
      block:
        - name: Start Cassandra service
          ansible.builtin.service:
            name: cassandra
            state: "{{ state }}"

        - name: Start AxonOps Agent
          ansible.builtin.service:
            name: axon-agent
            state: "{{ state }}"

        - name: Wait for Cassandra to be up and running
          ansible.builtin.wait_for:
            port: 9042
            host: "{{ cassandra_listen_address | default(ansible_default_ipv4.address) | default('localhost') }}"
            timeout: 300
            state: started

# code: language=ansible
